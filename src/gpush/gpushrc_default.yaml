parallel_run:
  - name: "uncommitted git changes"
    shell: "git diff --quiet --exit-code"

  #
  # Ruby
  #

  - name: "rspec"
    shell: "bundle exec rspec"
    if: "bundle list | grep 'rspec'"

  - name: "brakeman"
    shell: "bundle exec brakeman --run-all-checks --no-pager --quiet"
    if: "bundle list | grep 'brakeman'"

  - name: "bundle audit"
    shell: "bundle exec bundle-audit --update"
    if: "test -f Gemfile.lock"

  - name: "bundle leak"
    shell: "bundle leak --update"
    if: "test -f Gemfile.lock"

  - name: "rubocop"
    shell: "bundle exec rubocop"
    if: "test -f Gemfile.lock"

  #
  # Javascript
  #

  - name: "jest"
    shell: "npm run | grep -q ' jest' && npm run jest || npx jest"
    if: "npm list jest"

  - name: "npm audit"
    shell: "npm audit --audit-level=high"
    if: "test -f package-lock.json"

  - name: "yarn audit"
    shell: "yarn audit"
    if: "test -f yarn.lock"

  - name: "prettier"
    shell: "npm run prettier || npx prettier --ignore-unknown"
    if: "npm list prettier"

  #
  # Yaml
  #
  - name: "yaml lint"
    shell: "npx yamllint **/*.(yaml|yml) --ignore-dir=.node_modules"
    if: "npm list yamllint"


