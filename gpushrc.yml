gpush_version: ">=2.6.2"
success_emoji: "üíê"

get_specs:
  include_pattern: spec/**/*spec.rb
  exclude_words: spec_helper

fix:
  - shell: bundle exec rubocop --autocorrect 'src/**/*.rb'
  - shell: npx prettier --write --ignore-unknown 'src/**/*'

pre_run:
  - shell: bundle check
  - shell: curl 'https://raw.githubusercontent.com/nitidbit/gpush/main/.prettierrc.json' -O
  - shell: curl https://raw.githubusercontent.com/nitidbit/gpush/main/nitid_linter_configs/log-coverage.mjs -O

parallel_run:
  - name: rspec
    shell: bundle exec rspec --format documentation

  - name: prettier
    shell: npx prettier --check --ignore-unknown 'src/**/*'

  - name: rubocop
    shell: bundle exec rubocop

  - name: Uncommitted git changes
    shell: git diff --name-only --exit-code

  - name: bundle audit
    shell: bundle exec bundle audit --update

  - name: bundle leak
    shell: bundle exec bundle leak --update

  - name: should always pass
    shell: exit 0

  - name: Check yaml files
    shell: |
      ruby -ryaml -e 'Dir.glob("**/*.{yml,yaml}").each { |file| raise "problem with: #{file}" unless YAML.load_file(file).is_a?(Hash) }'

  # just confirm this does not thorow an error
  - shell: gpush_changed_files

  - shell: gpush_get_specs

  - name: gpush run
    shell: gpush run shouldalways_PASS # test normalizing the command name

  - name: always skipped
    shell: echo "This should never run"
    if: exit 1

post_run:
  - name: verbosity
    shell: echo "pre_run and post_run commands can be run with individual 'verbose' setting"
    verbose: true

post_run_success:
  - name: "Log Coverage"
    shell: node log-coverage.mjs "Gpush" coverage/.resultset.json
